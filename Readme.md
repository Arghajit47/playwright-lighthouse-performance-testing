#  Playwright - Lighthouse Performance Test <img height="50" width="50" align="center" src="https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif">


This project integrates Playwright and Lighthouse to automate performance testing for web applications. It focuses on testing both authorized (logged-in) and unauthorized (public) user flows, capturing key performance metrics such as page load time, time-to-interactive, and more. These tests are run in both desktop and mobile configurations, providing a thorough evaluation of your application's performance under different user scenarios.

## Table of Contents

- [Project Purpose](#project-purpose)
- [Prerequisites](#prerequisites)
- [Setup Instructions](#setup-instructions)
  - [Installing Dependencies](#installing-dependencies)
  - [Environment Variables](#environment-variables)
- [Running Tests](#running-tests)
  - [Authorized User Tests](#authorized-user-tests)
  - [Unauthorized User Tests](#unauthorized-user-tests)
  - [General Tests](#general-tests)
- [Test Structure](#test-structure)
  - [Authorized Performance Tests](#authorized-performance-tests)
  - [Unauthorized Performance Tests](#unauthorized-performance-tests)
- [CI Integration](#ci-integration)
- [Project Structure](#project-structure)
- [Dependencies](#dependencies)

---

##  Project Purpose 

This project aims to simplify and automate performance testing by combining Playwright, a powerful browser automation tool, with Lighthouse, a web performance audit tool. The focus is on two distinct user journeys:

- **Authorized (logged-in) users**: Performance metrics for authenticated user flows.
- **Unauthorized (public) users**: Performance metrics for users without authentication.

These tests evaluate the performance of your web application across both desktop and mobile environments.

---

##  Prerequisites 

Before you begin, make sure you have the following installed:

- **Node.js**: Use the latest LTS (Long Term Support) version of Node.js.
- **npm**: Comes pre-installed with Node.js. This is used to manage dependencies.

Check your Node.js and npm versions by running:

```bash
node -v
npm -v
```

---

##  Setup Instructions 

###  Installing Dependencies 

Ensure you have the correct versions of the dependencies by using the `npm ci` command, which installs exactly what is specified in the `package.json` file, without making any updates to versions.

```bash
npm ci
```

> **Important**: Do not modify the versions of the dependencies listed in `package.json`. Any changes to the versions might lead to failed tests, as the project relies on specific versions of both Playwright and Lighthouse.

###  Environment Variables 

This project requires a few environment variables to manage login for authenticated tests. Create a `.env` file in the root of your project with the following variables:

```bash
EMAIL=<your_login_email>
PASSWORD=<your_login_password>
```

These values will be used during the tests to perform login actions on your website.

---

##  Running Tests 

This project contains several npm scripts for running different types of performance tests.

###  Authorized User Tests 

To run the performance tests for authorized users (i.e., users who need to log in):

```bash
npm run test:Auth
```

This script will:
1. Remove any previous reports generated by authorized tests.
2. Execute both desktop and mobile performance audits for authorized users using Playwright and Lighthouse.

###  Unauthorized User Tests 

To run the performance tests for unauthorized users (i.e., users who do not need to log in):

```bash
npm run test:UnAuth
```

This script will:
1. Remove any previous reports generated by unauthorized tests.
2. Execute both desktop and mobile performance audits for unauthorized users.

###  General Tests 

To run the general performance tests (without focusing on authorization):

```bash
npm run test
```

This script will:
- Execute a general performance audit without cleaning or distinguishing between authorized and unauthorized tests.

---

##  Test Structure 

###  Authorized Performance Tests 

Located in the `tests/Auth/` directory, these tests simulate the behavior of users who are required to log in. They include:

- Navigating to a URL.
- Logging in using credentials stored in environment variables.
- Running both desktop and mobile performance audits using Lighthouse.

Example: `Auth/performance.spec.ts`

###  Unauthorized Performance Tests 

Located in the `tests/UnAuth/` directory, these tests simulate the performance of your web application for users who are not logged in. They measure performance metrics for the public-facing parts of the application.

Example: `UnAuth/performance.spec.ts`

---

##  CI Integration 

This project is configured to run tests automatically on push or pull request events using GitHub Actions. The `playwright.yml` file contains the workflow configuration that performs the following steps:

1. **Install dependencies**: Runs `npm ci` to install the required dependencies.
2. **Install Playwright browsers**: Ensures the necessary browsers are installed for running the tests.
3. **Run tests**: Executes the Playwright-Lighthouse tests and uploads the performance reports as artifacts.
4. **Upload reports**: The performance reports generated by both authorized and unauthorized tests are uploaded as artifacts, stored for 30 days.

### Example GitHub Actions Workflow (`playwright.yml`) 

The CI workflow is triggered on:
- Pushes to `main` or `master` branches.
- Pull requests to `main` or `master`.

The performance reports will be available as downloadable artifacts after the workflow completes.

---

##  Project Structure 

The repository is organized as follows:

```
├── tests
│   ├── Auth
│   │   └── performance.spec.ts    # Authorized performance tests
│   ├── UnAuth
│   │   └── performance.spec.ts    # Unauthorized performance tests
├── utils
│   └── helpers.ts                 # Helper functions for running audits
├── lighthouse
│   └── base.ts                    # Lighthouse configuration
├── test-data
│   └── enum.ts                    # URLS for the tests
├── .env                           # Environment variables (not included in repo)
├── package.json                   # Project dependencies and scripts
├── playwright.config.ts           # Playwright configuration
├── playwright.yml                 # GitHub Actions CI workflow
```

---

##  Dependencies 

This project depends on the following tools:

- **@playwright/test** (`^1.47.1`): A testing framework for Playwright to run browser-based tests.
- **lighthouse** (`9.6.8`): A tool to audit web applications for performance, accessibility, SEO, and more.
- **dotenv** (`^16.4.5`): For managing environment variables.
- **playwright-lighthouse** (`2.2.2`): A utility that allows integrating Playwright with Lighthouse for performance audits.

Make sure to use the exact versions specified in `package.json` to avoid any issues with the tests.

```json
"devDependencies": {
  "@playwright/test": "^1.47.1",
  "lighthouse": "9.6.8"
},
"dependencies": {
  "@lighthousejs/types": "^0.0.3",
  "dotenv": "^16.4.5",
  "playwright-lighthouse": "2.2.2"
}
```

---

##  Notes 

- Ensure you set up the environment variables correctly, as the authenticated tests depend on them.
- Always use `npm ci` instead of `npm install` to prevent version changes that might cause test failures.
- Run `npm run test` to execute both kinds of tests (Authorized and Unauthorized).
- For CI/CD The repo already has the secrets saved, i.e.,

```
env:
    EMAIL: ${{ secrets.EMAIL }}
    PASSWORD: ${{secrets.PASSWORD}}
```
